<div class="row">
  <div class="columns large-12" id="model-results-header">
    <h1><a ui-sref="networkMetaAnalysis(stateParams)">{{analysis.title}}</a></h1>
    <h5><strong>Outcome</strong></h5>
    <h5>{{analysis.outcome.name}}<span ng-show="result.results.logScale"> (log scale)</span></h5>
    <h5><strong>Model</strong></h5>
    <h5>{{model.title}}</h5>
  </div>
</div>
<div class="row">
  <div class="columns large-12">
    <div>
      <span ng-if="!result.results">
        <h4 class="inline-header">Loading model / {{progress.percentage | number:2}} % complete</h4>
      </span>
      <div ng-if="result.results" style="padding-top: 1rem;" id="model-results-results-header">
        <div class="row">
          <div class="columns columns large-6 medium-8 small-12">
            <div class="panel callout">
              <h5><strong>Model settings</strong></h5>
              <table class="layout-table">
                <tr>
                  <td class="large-6 text-right"><strong>model type</strong></td>
                  <td>{{::model.modelType.type}}</td>
                </tr>
                <tr ng-if="model.modelType.type === 'pairwise'">
                  <td class="large-6 text-right"><strong>pairwise comparison</strong></td>
                  <td>{{::model.modelType.details.from.name}} &mdash; {{::model.modelType.details.to.name}}</td>
                </tr>
                <tr ng-if="model.modelType.type === 'node-split'">
                  <td class="large-6 text-right"><strong>split comparison</strong></td>
                  <td>{{::model.modelType.details.from.name}} &mdash; {{::model.modelType.details.to.name}}</td>
                </tr>
                <tr>
                  <td class="large-6 text-right"><strong>effects type</strong></td>
                  <td>{{::result.results.linearModel}}</td>
                </tr>
                <tr>
                  <td class="large-6 text-right"><strong>outcome scale</strong></td>
                  <td ng-if="model.outcomeScale">{{::model.outcomeScale}}</td>
                  <td ng-if="!model.outcomeScale">{{::result.results.outcomeScale}} (imputed)</td>
                </tr>
                <tr>
                  <td class="large-6 text-right"><strong>likelihood / link</strong></td>
                  <td>{{::result.results.likelihood}} / {{::result.results.link}}</td>
                </tr>
                <tr>
                  <td class="large-6 text-right" style="vertical-align:top;"><strong>run-length</strong></td>
                  <td>
                    <ul class="no-bullet" style="font-size: 0.875rem; vertical-align:top; line-height: initial;">
                      <li style="padding-bottom: 0.5rem">burn-in: {{::result.results.burnInIterations}}</li>
                      <li style="padding-bottom: 0.5rem">inference: {{::result.results.inferenceIterations}}</li>
                      <li style="padding-bottom: 0.5rem">thinning: {{::result.results.thinningFactor}}</li>
                    </ul>
                  </td>
                </tr>
              </table>
            </div>
          </div>
        </div>
        <div class="row">
          <div class="columns">
            <div class="row" style="padding-top: 1rem;">
              <div class="columns large-3">
                <h3 class="main-category-header">Convergence diagnostics</h3>
              </div>
              <div class="columns large-8 end">
                <hr>
              </div>
            </div>
            <div class="row">
              <div class="columns large-8 medium-6 small-12">
                <div>
                  <table export>
                    <caption>Per-parameter convergence diagnostics</caption>
                    <thead>
                      <tr>
                        <td colspan="3"></td>
                        <td colspan="2">Potential scale reduction factor (PSRF)</td>
                      </tr>
                      <tr>
                        <td>Parameter</td>
                        <td>Mean</td>
                        <td>Time-series S.E.</td>
                        <td>Point estimate</td>
                        <td>97.5% quantile</td>
                      </tr>
                    </thead>
                    <tbody>
                      <tr ng-repeat="diagnostic in gelmanDiagnostics| orderBy:'label'">
                        <td>{{diagnostic.label}}</td>
                        <td>{{result.results.summaries.statistics[diagnostic.key].Mean}}</td>
                        <td>{{result.results.summaries.statistics[diagnostic.key]['Time-series SE']}}</td>
                        <td>{{diagnostic['Point est.']}}</td>
                        <td>{{diagnostic['Upper C.I.']}}</td>
                      </tr>
                    </tbody>
                  </table>
                </div>
                <button id="show-convergence-diagnostics" ng-show="!isConvergencePlotsShown" ng-click="showConvergencePlots()">Show diagnostics plots</button>
                <button id="hide-convergence-diagnostics" ng-show="isConvergencePlotsShown" ng-click="hideConvergencePlots()">Hide diagnostics plots</button>
              </div>
            </div>
            <div class="row" ng-show="isConvergencePlotsShown">
              <div class="columns large-6 medium-6 small-12">
                <p><strong>Time series plots</strong></p>
                <paged-png-plot file-name="'tracePlot'" pages="result.results.tracePlot"></paged-png-plot>
              </div>
            </div>
            <div class="row" ng-show="isConvergencePlotsShown">
              <div class="columns large-6 medium-6 small-12">
                <p><strong>PSRF plots</strong></p>
                <paged-png-plot file-name="'psrfPlot'" pages="result.results.gelmanPlot"></paged-png-plot>
              </div>
            </div>
          </div>
        </div>
        <div class="row">
          <div class="columns">
            <div class="row" style="padding-top: 1rem;">
              <div class="columns large-3">
                <h3 class="main-category-header">Model fit</h3>
              </div>
              <div class="columns large-8 end">
                <hr>
              </div>
            </div>
            <div class="row">
              <div class="columns large-8 medium-6 small-12">
                <div>
                  <table export>
                    <caption>Model fit statistics</caption>
                    <tbody>
                      <tr>
                        <td>Residual deviance D_res</td>
                        <td>{{result.results.residualDeviance}}</td>
                      </tr>
                      <tr>
                        <td>Leverage (p_D)</td>
                        <td>{{result.results.leverage}}</td>
                      </tr>
                      <tr>
                        <td>DIC</td>
                        <td>{{result.results.DIC}}</td>
                      </tr>
                    </tbody>
                  </table>
                </div>
              </div>
            </div>
            <div class="row">
<<<<<<< Updated upstream
              <div class="columns large-6 medium-6 small-12">
                <img ng-src="{{result.results.deviancePlot[0]}}">
              </div>
            </div>
            <div class="row" ng-show="isConvergencePlotsShown">
              <div class="columns large-6 medium-6 small-12">
                <p><strong>Time series plots</strong></p>
                <paged-png-plot file-name="'tracePlot'" pages="result.results.tracePlot"></paged-png-plot>
              </div>
            </div>
            <div class="row" ng-show="isConvergencePlotsShown">
              <div class="columns large-6 medium-6 small-12">
                <p><strong>PSRF plots</strong></p>
                <paged-png-plot file-name="'psrfPlot'" pages="result.results.gelmanPlot"></paged-png-plot>
=======
              <div class="columns large-12 medium-12 small-12">
                <img export file-name="'residualDeviancePlot'" ng-src="{{result.results.deviancePlot[0]}}">
              </div>
            </div>
            <div class="row">
              <div class="columns large-12 medium-12 small-12">
                <table>
                  <thead>
                    <caption>Residual deviance per arm per study</caption>
                  </thead>
                  <tbody>
                    <tr ng-repeat="(studyName, arms) in result.results.devianceStatistics.perArmDeviance">
                      <td>{{studyName}}</td>
                      <td ng-repeat="arm in arms">{{arm}}</td>
                    </tr>
                  </tbody>
                </table>
>>>>>>> Stashed changes
              </div>
            </div>
          </div>
        </div>
        <div class="row" style="padding-top: 1rem;">
          <div class="columns large-1">
            <h3 class="main-category-header">Results</h3>
          </div>
          <div class="columns large-8 end">
            <hr>
          </div>
        </div>
        <div class="row" ng-show="model.linearModel === 'random'" style="padding-top: 1rem;">
          <div class="columns large-12">
            <p><strong>Random effects standard deviation </strong> {{result.results.summaries.quantiles["sd.d"]["50%"] | number: 3}} ({{result.results.summaries.quantiles["sd.d"]["2.5%"] | number: 3}}, {{result.results.summaries.quantiles["sd.d"]["97.5%"] | number: 3}})</p>
          </div>
        </div>
        <div class="row" ng-if="model.modelType.type === 'node-split'">
          <div class="column large-12">
            <table>
              <caption>Node splitting results</caption>
              <thead>
                <tr>
                  <td> </td>
                  <td>Median (95% CrI)</td>
                </tr>
              </thead>
              <tr>
                <td><strong>Direct estimate</strong></td>
                <td>{{::result.results.summaries.quantiles['d.direct']['50%'] | number: 3}} ({{::result.results.summaries.quantiles['d.direct']['2.5%'] | number: 3}}, {{::result.results.summaries.quantiles['d.direct']['97.5%'] | number: 3}})</td>
              </tr>
              <tr>
                <td><strong>Indirect estimate</strong></td>
                <td>{{::result.results.summaries.quantiles['d.indirect']['50%'] | number: 3}} ({{::result.results.summaries.quantiles['d.indirect']['2.5%'] | number: 3}}, {{::result.results.summaries.quantiles['d.indirect']['97.5%'] | number: 3}})</td>
              </tr>
            </table>
          </div>
        </div>
        <div class="row" style="padding-top: 1rem;" ng-if="model.modelType.type !== 'node-split'">
          <div class="columns large-12">
            <div class="table-title">Relative effects table comparing the included interventions:
              <span>{{::scaleName}}</span> (95% CrI).
              <br>Each cell gives the effect of the column-defining intervention relative to the row-defining intervention.
            </div>
            <div>
              <table export>
                <tr ng-repeat="relativeEffectsRow in relativeEffectsTable.rows">
                  <td class="text-center" ng-class="{'empty-cell': $index <= $parent.$index-1}" ng-repeat="relativeEffectsCell in relativeEffectsRow.cells" ng-switch="relativeEffectsCell.cellType">
                    <span ng-switch-when="effect">
                      {{relativeEffectsCell.mean | number: 3}} ({{relativeEffectsCell.lowerBound | number: 3}}, {{relativeEffectsCell.upperBound | number: 3}})
                    </span>
                    <span ng-switch-when="label" class="table-cell-label">
                      {{relativeEffectsCell.label}}
                    </span>
                    <span ng-switch-when="empty"></span>
                  </td>
                </tr>
              </table>
            </div>
          </div>
        </div>
        <div class="row" ng-if="model.modelType.type === 'network'">
          <div class="columns">
            <div class="row">
              <div class="columns large-6 small-8">
                <p><strong>Relative effects plots</strong></p>
                <label>Select baseline:
                  <select ng-options="treatment.name for treatment in problem.treatments" ng-model="selectedBaseline"></select>
                </label>
              </div>
            </div>
            <div class="row">
              <div class="columns center">
                <paged-svg-plot file-name="'relativeEffect'" pages="result.results.relativeEffectPlots[selectedBaseline.id]"></paged-svg-plot>
              </div>
            </div>
          </div>
        </div>
        <div class="row" ng-if="model.modelType.type === 'pairwise'">
          <div class="columns">
            <div class="row">
              <div class="columns large-6 small-8">
                <p><strong>Study effect forest plot</strong></p>
                <paged-svg-plot file-name="'forestPlot'" pages="result.results.studyForestPlot"></paged-svg-plot>
              </div>
            </div>
          </div>
        </div>
        <div class="row" ng-if="model.modelType.type === 'node-split'">
          <div class="columns">
            <div class="row">
              <div class="columns large-6 small-8">
                <p><strong>Density plot</strong></p>
                <paged-png-plot file-name="'densityPlot'" pages="result.results.densityPlot"></paged-png-plot>
              </div>
            </div>
          </div>
        </div>
        <div class="row" style="padding-top: 1rem;" ng-if="model.modelType.type !== 'node-split'">
<<<<<<< Updated upstream
          <div class="columns large-4">
=======
          <div class="columns large-12">
>>>>>>> Stashed changes
            <div>
              <p><strong>Rank probabilities</strong></p>
            </div>
            <table id="ranktable" export>
              <caption>Rank probabilities table</caption>
              <thead>
                <tr>
                  <th></th>
                  <th ng-repeat="rank in result.results.rankProbabilities">Rank {{::$index + 1}}</th>
                </tr>
              </thead>
              <tbody>
                <tr ng-repeat="(key, treatments) in problem.treatments">
                  <td>{{::treatments.name}}</td>
                  <td ng-repeat="rank in result.results.rankProbabilities[treatments.name]">
                    {{::rank | number}}
                  </td>
                </tr>
              </tbody>
            </table>
          </div>
        </div>
        <div class="row" style="padding-top: 1rem;" ng-if="model.modelType.type !== 'node-split'">
<<<<<<< Updated upstream
          <div class="columns large-4">
            <div class="addis-graph" style="height:450px;" export file-name="'rankProbabilities'">
=======
          <div class="columns large-12">
            <div class="addis-graph" style="width:450px; height:450px;" export file-name="'rankProbabilities'">
>>>>>>> Stashed changes
              <caption>Rank probabilities plot</caption>
              <gemtc-rank-plot value="result.results.rankProbabilities" stacked="true"></gemtc-rank-plot>
            </div>
          </div>
        </div>
        <div class="row" style="padding-top: 2rem;" ng-if="model.modelType.type !== 'node-split'">
          <div class="columns large-6 medium-10 small-12">
            <div class="panel callout">
              <p>The rank probability plot shows how likely it is that each intervention has a particular rank, with rank 1 being the highest outcome value.</p>
              <p>Ranks can be shown as grouped or stacked.</p>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>
